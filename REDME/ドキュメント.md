# ethernet can 変換モジュール

## できること

ethernet と can のデータの変換  
can でのエラー状態は ethernet,ethernet のエラー状態は can に垂れ流す  
終端抵抗をジャンパーで ON/OFF 切換え可能  
電源+GPIO1 つのコネクタ有り

## 仕様

### データ量

- ethernet15 バイト
- can8 バイト

### 仕様マイコン、モジュール

- XIAO ESP32S3
- W5500LITE
- MCP2562FD

### ポート

- ethernet LAN 1 口
- can+(5V,GND) XA1x04 1 口
- 5V,GND,GPIO XA1x03 1 口
- 終端抵抗 ON/OFF pin_socket1x02 1 口

### データ内容

#### ethernet

送信、受信ともに 15 バイト  
| バイト | 0 | 1 | 2 | 3 | 4 |
| ---- | ---- | ---- | ---- | ---- | ---- |
| 内容 | extid<br>(true or false) | id<br>(上位 8bit) | id<br>(中位上位 8bit) | id<br>(中位下位 8bit) | id<br>(下位 bit) |

| 5 ~ 12            | 13                                       | 14                                     |
| ----------------- | ---------------------------------------- | -------------------------------------- |
| can_data[0] ~ [7] | can エラーステータス<br>(受信データのみ) | can エラーコマンド<br>(受信データのみ) |

#### can

stdid 0x7ff にエラーデータが更新されたときにエラーデータ 1 バイト分送信

#### エラーデータ内容

- ethernet(can のエラー)  
  13 バイト エラーステータス
  | 値 | 0x00 | 0x01 | 0x02 | 0x03 |
  | ---- | ---- | ---- | ---- | ---- |
  | 意味 | 停止中 | 通信中 | エラー | エラー回復 |

  14 バイト エラーコマンド  
  | 値 | 0x01 | 0x02 | 0x04 | 0x08 |
  | ---- | ---- | ---- | ---- | ---- |
  | 意味 | エラーなし | can ドライバインストール失敗 | can ドライバ起動失敗 | 受信失敗 |

- can(ethernet のエラー)
  | 値 | 0x01 | 0x02 | 0x04 | 0x08 | 0x10 |
  | ---- | ---- | ---- | ---- | ---- | ---- |
  | 意味 | エラーなし | W5500 未接続 | ethernet ケーブル未接続 | 受信失敗 | 受信データ異常長 |
